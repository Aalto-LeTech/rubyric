<% content_for :javascript do %>
  <%= javascript_include_tag 'assignmentEditor.js' %>
<% end %>

<div class="page-header">
  <h1><%= "#{@course.code} #{@course.name} - #{@course_instance.name}" %></h1>
</div>

<% if @course_instance.assistants.empty? %>
  <div class="alert alert-info">
    In this view, you can assign groups to reviewers. If the course has no teaching assistants, you can skip this step.
  </div>
<% else %>
  <div class="hint">
    <p>In this view, you can assign groups to reviewers.</p>
    <ul>
      <li>Teaching assistants can only see groups that are assigned to them.</li>
      <li>Teachers can see and review all groups.</li>
    </ul>
  </div>
<% end %>

<div class="row-fluid busy" id="assign-groups" data-url="<%= course_instance_groups_path(@course_instance) %>">
  <table class="table table-hover table-condensed">
    <thead>
      <tr>
        <th></th>
        <th>Members</th>
        <th>Reviewers</th>
        <th></th>
      </tr>
    </thead>
    <tbody data-bind="foreach: { data: groups, as: 'group' }">
      <tr>
        <td>
          <input type="checkbox" data-bind="checked: selected" />
        </td>
        <td data-bind="text: name">
        </td>
        <td data-bind="foreach: reviewers">
          <span class="label label-info">
            <span data-bind="text: name"></span> <a class="removeAssignment" href="#">&times;</a>
          </span>
        </td>
        <td class="hover-buttons">
          <button class="btn btn-small" data-bind="click: clickAssign">Add reviewer...</button>
        </td>
      </tr>
    </tbody>
  </table>
</div>  

<!-- Buttons -->
<div class="row">
  <div class="span6">
    <p>
      <button class="btn" data-bind="click: clickSelectAll">Select all</button>
      <button class="btn" data-bind="click: clickSelectNone">Select none</button>
    </p>
    
    <p>
      <button class="btn" data-bind="click: clickAssign">Assign selected to</button>
      <select data-bind="value: currentReviewer">
        <option value="assistants">Assistants evenly</option>
        <option value="evenly">All staff evenly</option>
        <!-- ko foreach: reviewers -->
        <option data-bind="text: name, value: id"></option>
        <!-- /ko -->
      </select>
    </p>
  </div>
  
  <div class="span6">
    <h2>Reviewer workloads</h2>
    
    <table class="table">
      <thead>
        <tr>
          <th>Reviewer</th>
          <th>Groups</th>
        </tr>
      </thead>
      <tbody data-bind="foreach: reviewers">
        <tr>
          <td><span data-bind="text: name" /></td>
          <td><span data-bind="text: assignments().length" /></td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <button id="save-button" class="btn btn-primary" data-bind="click: clickSave">Save</button>
</div>

<!-- Assign modal -->
<div id="modalAssign" class="modal hide">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    <h3>Assign group to reviewer</h3>
  </div>
  <div class="modal-body">
    <p>Assign group to</p>
    <ul data-bind="foreach: reviewers">
      <li><a href="#" data-bind="click: $root.clickModalAssign"><span data-bind="text: name" /></a></li>
    </ul>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
  </div>
</div>
